<include file="Public:header" />
<script type="text/javascript" src="__BCS_PUBLIC__/js/jquery-2.1.3.min.js"></script>
</head>
<body>
	<div class="wrap">
		<include file="Public:logo" />
		<form method="post" action="__SELF__" class="formclass width300" name="upload_form" id="form">
			<h1>3D ANT</h1>
			<input type='text' name='username' id='username'
				class='formclass-input' placeholder="用户名" /> 
			<input type='text' name='password' id='password'
				class='formclass-input' placeholder="密码" /> 
				<input type='text' name='verify' id='verify'
				class='formclass-input' placeholder="输入下方验证码" /> 
				<img class="verify" alt="点击切换" title="点击切换" src="__URL__/verify" style="cursor:pointer;" onclick="this.src='__URL__/verify/'+Math.random()"/>
			<input type="submit" value="登 陆" name="B1" class="formclass-submit" />
			<p class="formclass-help"><a href="index.html">忘记密码？</a> | <a href="index.html">注册新用户</a></p>
            <h1 id="error"></h1>
		</form>
		
		<include file="Public:footer" />
	</div>
	<script>
	$(document)
	.ajaxStart(function(){
		$("input:submit").addClass("log-in").attr("disabled", true);
	})
	.ajaxStop(function(){
		$("input:submit").removeClass("log-in").attr("disabled", false);
	});
	var validator = new FormValidator(
			'upload_form',
			[ {
				name : 'username',
				display : '用户名',
				rules : 'required'
			}, {
				name : 'password',
				display : '密码',
				rules : 'required'
			}, {
				name : 'verify',
				display : '验证码',
				rules : 'required'
			} ],
			function(errors, evt) {
				if (errors.length > 0) {
					var errorString = '';

					for (var i = 0, errorLength = errors.length; i < errorLength; i++) {
						errorString += errors[i].message + '<br />';
					}
					document.getElementById("error").innerHTML=errorString;				    
				}else{
				var self = $("form");
				alert(self.attr("action"));
	    		$.post(self.attr("action"), self.serialize(), success, "json");	    		
	    		function success(data){
	    			alert("发送成功");
	    			if(data.status){
	    				alert("返回true");
	    				window.location.href = data.url;
	    			} else {
	    				alert("返回false");
	    				self.find("#error").text(data.info);
	    				//刷新验证码
	    				$(".verify").click();
	    			}
	    		}
			}
				if (evt && evt.preventDefault) {
			        evt.preventDefault();				        
			    } else if (event) {
			        event.returnValue = false;
			    }
			});			
	</script>
</body>
</html>