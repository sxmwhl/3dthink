<include file="Public:header" />
<script type='text/javascript' src='__BCS_PUBLIC__/js/x3dom.js'></script>
<script type='text/javascript' src='__BCS_PUBLIC__/js/additional-methods.min.js'></script>
<script>
	$(document).ready(function(){				
	$("#btnTakeScreenshot").click(function(){
			var imgUrl=screenShot("x3d_canvas");
			$("#preview_img").attr("src", imgUrl);
			$("#download").attr("href", imgUrl);
			$("#download").attr("download", "screenshot.png");
			$("#preview_name").html("右侧截图，点击下载后上传");
			$("#preview_name").css("color", "red");
		});
		$("#upload_form").validate({
			rules : {
				preview : {
					accept : "image/*",
				},
			},
			messages : {
				preview : {
					accept : "缩略图文件格式不正确！"
				}
			}
		});
	});
</script>

</head>
<body>
	<input type='radio' name='model' id='modelcategory' />
	<input type='radio' name='model' id='myhide' />
	<div id='content'>
		<label id='slider' class='modelcategory' for='modelcategory'>更多模型</label>
		<label id='slider' class='myhide' for='myhide'>收起侧栏</label>
	</div>
	<aside class="modelcategory">
		<include file="Public:moreModel" />
	</aside>
	<div class="container-fluid">
		<include file="Public:logo" />
		<div class="row">
			<div class="col-md-6" align="center">
				<div class='item'>
					<img id='preview_img'
						src='__BCS_UPLOAD__/{$model.folder}/preview.{$model.preview_ext}'
						alt='{$model.title}' />
					<div class='item-background'></div>
					<a href='__MODULE__/index/model?f={$model.folder}' class='title'
						title='模型名称'>模型名称：{$model.title}</a> <a
						href='__MODULE__/index/model?f={$model.folder}' class='creator'
						title='作者'>创作者：{$model.creator}</a> <a
						href='__MODULE__/index/model?f={$model.folder}' class='time'
						title='更新时间'>更新时间：{$model.time_update}</a>
				</div>
				<p id="preview_name" class="text-center">模型缩略图</p>
			</div>
			<div class="col-md-6">
				<div class='item'>
					<x3d id='x3d_canvas'> <scene dopickpass="true" pickmode="idBuf"
						bboxsize="-1,-1,-1" bboxcenter="0,0,0" render="true" def="scene">
					<navigationInfo id="head" headlight='{$model.hl_on}'
						type='"EXAMINE"'></navigationInfo> <directionalLight
						id="directional" on="{$model.dl_on}"></directionalLight> <Viewpoint
						id='viewpoint' description='Default Viewpoint'
						position='{$model.vp_position}'
						orientation='{$model.vp_orientation}'></Viewpoint> <background
						topurl="" righturl="" lefturl="" fronturl="" bottomurl=""
						backurl="__BCS_PUBLIC__/images/low_contrast_linen.png" skyangle=""
						groundangle="" groundcolor="" transparency="1.0" skycolor="0 0 0">
					</background> <Environment id="gamma" gammaCorrectionDefault="linear"></Environment>
					<Inline id="inline" nameSpaceName="s" mapDEFToID="true"
						url="__BCS_UPLOAD__/{$model.folder}/model.x3d"> </Inline> </scene> </x3d>					
				</div>
				<p class="text-center">实际模型（点击模型后，按下A键）</p>
			</div>
		</div>

		<div class="row text-center mg-top20">
		<form method="post" action="__URL__/change"	enctype="multipart/form-data" class="form-inline" role="form" name="upload_form" id="upload_form">			
			<input type="hidden" name="MAX_FILE_SIZE" value="10485760" /> 
			<input type="hidden" name="folder" value="{$model.folder}" />
			<input type="hidden" name="preview_ext" value="{$model.preview_ext}" />
			<div class="form-group">
			<label>更换模型缩略图（可
			<button id="btnTakeScreenshot" type="button" class="btn btn-primary btn-xs">
  <span class="glyphicon glyphicon-scissors" aria-hidden="true"></span> 截取
</button>右侧模型图>>
			<a id="download" class="btn btn-primary btn-xs" role="button" target="_blank">
  <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span> 下载
</a>）
			</label>			
			<input name="preview" id="preview" type="file" value="浏览" accept="image/png,image/gif,image/jpeg,image/pjpeg" class="form-control"/>
			<button type="submit" class="btn btn-primary">上传缩略图</button>
			</div>
		</form>
		</div>
	</div>
	<include file="Public:footer" />
	<script type="text/javascript" charset="utf-8">
	x3dom.runtime.ready = function() {
		var e = document.getElementById("canvas");
		$("#inline").load(function(){
			e.runtime.showAll();
		});
	};	
	</script>
</body>
</html>