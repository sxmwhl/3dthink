var tsfNum=0,pickID="",pickNum=0,last_pick_id="",tsf_selector="",pickInfo,viewFunc=function(b){pos=b.position;rot=b.orientation;mat=b.matrix;x=Math.round(1E3*rot[0].x)/1E3;y=Math.round(1E3*rot[0].y)/1E3;z=Math.round(1E3*rot[0].z)/1E3;a=Math.round(1E3*rot[1])/1E3;$("#"+pickID).attr("position","0,0,0");$("#"+pickID).attr("rotation",x+","+y+","+z+","+a);set_form()};
function rotate(b,c){document.getElementById(b).addEventListener("viewpointChanged",function(b){pos=b.position;rot=b.orientation;mat=b.matrix;$("#"+c).attr("position","0,0,0");$("#"+c).attr("rotation",rot[0].x+","+rot[0].y+","+rot[0].z+","+rot[1])},!0)}function get_max_id(){var b=0,c="",d=[],e=0;$("group#cn_3dant_diy").children().each(function(){$(this).children().each(function(){c=$(this).attr("id");d[b]=c;b+=1})});if(0===d.length)return 0;d.sort();return e=Number(d[d.length-1].substr(1))}
function show_model_list(){var b=0;$("tr#title").nextAll("tr").remove();$("group#cn_3dant_diy").children().each(function(){$(this).children().each(function(){var d=$(this).attr("id"),c=$(this).attr("description"),f="<button id='select"+d+"' type='button' class='btn btn-default btn-xs' aria-label='\u9009\u62e9'><span class='glyphicon glyphicon-ok' aria-hidden='true'></span></button>",g="<button id='delete"+d+"' type='button' class='btn btn-default btn-xs' aria-label='\u5220\u9664'><span class='glyphicon glyphicon-remove' aria-hidden='true'></span></button>",
h="<button id='show"+d+"' type='button' class='btn btn-default btn-xs' aria-label='\u67e5\u770b'><span class='glyphicon glyphicon-zoom-in' aria-hidden='true'></span></button>",k=$(this).attr("tag"),c="<tr><td>"+d+"</td><td>"+c+"</td><td>"+f+"</td><td>"+g+"</td><td>"+h+"</td><td>"+k+"</td></tr>";$("tr#title").after(c);$("button#select"+d).attr("onclick","list_select_model('"+d+"')");$("button#delete"+d).attr("onclick","list_delete_model('"+d+"')");$("button#show"+d).attr("onclick","list_show_model('"+
d+"')");b+=1})});var c="<tr><td colspan='5'>\u5171\u8ba1"+b+"\u4e2a\u6a21\u578b</td></tr>";$("tr#title").after(c)}function set_pickid(b){last_pick_id=pickID;pickID=b;pickNum=parseInt(pickID.substr(1));tsf_selector="transform#"+pickID;document.getElementById("coordinateAxesViewpoint").addEventListener("viewpointChanged",viewFunc,!0)}
function form_disable(){$("[onchange='change()']").attr("disabled","disabled");$("input#radius").attr("disabled","disabled");$("shape#point_sphere").attr("render","false")}function form_enable(){$(":disabled").removeAttr("disabled");$("#point_sphere").attr("render","true")}
function set_form(){if(!pickID)return form_disable(),$(":disabled").val(""),$(".info").text(pickID),!1;form_enable();$(".info").html(pickID);var b=$(tsf_selector).attr("translation").split(",");$("#ts_x").val(b[0]);$("#ts_y").val(b[1]);$("#ts_z").val(b[2]);b=$(tsf_selector).attr("rotation").split(",");$("#rt_x").val(b[0]);$("#rt_y").val(b[1]);$("#rt_z").val(b[2]);$("#rt_a").val(b[3]);b=$(tsf_selector).attr("scale").split(",");$("#sc_x").val(b[0]);$("#sc_y").val(b[1]);$("#sc_z").val(b[2]);"cn_3dant_basic"===
$(tsf_selector).parent().attr("id")&&(b=$(tsf_selector).find("material").attr("diffusecolor").split(","),$("#color_r").val(b[0]),$("#color_g").val(b[1]),$("#color_b").val(b[2]));if($(tsf_selector).find("torus").length){var b=$(tsf_selector).find("torus").attr("innerradius"),c=$(tsf_selector).find("torus").attr("outerradius");$("input#torus1").val(b);$("input#torus2").val(c);$("div#torus").attr("class","form-group show")}else $("div#torus").attr("class","form-group hidden");"cn_3dant_basic"===$(tsf_selector).parent().attr("id")?
$("div#color").attr("class","form-group show"):$("div#color").attr("class","form-group hidden");b=$("transform#marker").attr("scale").split(",");$("input#radius").val(b[0]);b=$(tsf_selector).attr("description");$("input#title").val(b)}function selectmodel(b){set_pickid($(b).attr("id"));set_form()}function list_select_model(b){set_pickid(b);set_form();$("#modelListModal").modal("hide")}function list_show_model(b){set_pickid(b);set_form();showObject();$("#modelListModal").modal("hide")}
function change(){if(!pickID)return alert("\u8bf7\u9009\u62e9\u6a21\u578b\u540e\uff0c\u518d\u8c03\u6574\u53c2\u6570\uff01"),!1;var b=$("#ts_x").val()+","+$("#ts_y").val()+","+$("#ts_z").val();$(tsf_selector).attr("translation",b);b=$("#rt_x").val()+","+$("#rt_y").val()+","+$("#rt_z").val()+","+$("#rt_a").val();$(tsf_selector).attr("rotation",b);b=$("#sc_x").val()+","+$("#sc_y").val()+","+$("#sc_z").val();$(tsf_selector).attr("scale",b);b=$("input#title").val();$(tsf_selector).attr("description",b);
b=$("#color_r").val()+","+$("#color_g").val()+","+$("#color_b").val();$(tsf_selector).find("material").attr("diffusecolor",b);b=$("input#torus1").val();$(tsf_selector).find("torus").attr("innerradius",b);b=$("input#torus2").val();$(tsf_selector).find("torus").attr("outerradius",b)}function change_point_sphere(){var b=$("#radius").val(),b=b+","+b+","+b;$("#marker").attr("scale",b)}
function groupClick(b){pickInfo=b.hitPnt;$("#marker").attr("translation",pickInfo);b=Math.round(1E3*pickInfo[0])/1E3;var c=Math.round(1E3*pickInfo[1])/1E3,d=Math.round(1E3*pickInfo[2])/1E3;pickInfo=b+","+c+","+d;b="X:"+b+"<br/>Y:"+c+"<br/>Z:"+d;$("#xyz").html(b)}
function deletemodel(){if(!pickID)return alert("\u8bf7\u70b9\u51fb\u9009\u62e9\u8981\u5220\u9664\u7684\u6a21\u578b\uff01"),!1;if(!confirm("\u786e\u5b9a\u5220\u9664\u6a21\u578b"+pickID+"\uff1f"))return!1;if(null==$(tsf_selector).remove().attr("id"))return alert("\u6a21\u578b"+pickID+"\u5df2\u4e0d\u5b58\u5728\uff01"),!1;pickID="";set_form()}
function moveModel(){if(!last_pick_id)return alert("\u8bf7\u70b9\u51fb\u9009\u62e9\u8981\u79fb\u52a8\u7684\u6a21\u578b\u548c\u4f4d\u7f6e\uff01"),!1;$("#"+last_pick_id).attr("translation",pickInfo)}
function alignModel(){if(!last_pick_id)return alert("\u8bf7\u5148\u540e\u70b9\u51fb\u9009\u62e9\u8981\u5bf9\u9f50\u7684\u6a21\u578b\uff01"),$("#alignModelModal").modal("hide"),!1;if(last_pick_id===pickID)return alert("\u8bf7\u5148\u540e\u70b9\u51fb\u9009\u62e9\u8981\u5bf9\u9f50\u7684\u4e24\u4e2a\u4e0d\u540c\u7684\u6a21\u578b\uff01"),$("#alignModelModal").modal("hide"),!1;var b=$("#"+pickID).attr("translation").split(","),c=$("#"+last_pick_id).attr("translation").split(",");$("input#align_x").is(":checked")&&
(c[0]=b[0]);$("input#align_y").is(":checked")&&(c[1]=b[1]);$("input#align_z").is(":checked")&&(c[2]=b[2]);$("#"+last_pick_id).attr("translation",c.join(","));$("#alignModelModal").modal("hide")}function list_delete_model(b){set_pickid(b);deletemodel();$("#modelListModal").modal("hide")}
function emptymodel(){if(!confirm("\u786e\u5b9a\u79fb\u9664\u6240\u4ee5\u6a21\u578b\uff1f"))return!1;$("group#cn_3dant_shared").empty();$("group#cn_3dant_basic").empty();$("group#cn_3dant_internet").empty();tsfNum=0;pickID="";set_form()}function clearNoNum(b){b.value=b.value.replace(/[^\d.-]/g,"");b.value=b.value.replace(/^\./g,"");b.value=b.value.replace(/\.{2,}/g,".");b.value=b.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".")}
function addmodel(b){var c=$("#daima").val();if(!/^([a-fA-F0-9]{32})$/.test(c))return $("#daima").val("\u6a21\u578b\u4ee3\u7801\u683c\u5f0f\u9519\u8bef!!"),!1;b="<transform id='s"+tsfNum+"' tag='shared' description='\u672a\u547d\u540d' onMouseDown='selectmodel(this)' rotation='0,0,1,0' scale='1,1,1' translation='0,0,0'><Inline nameSpaceName='in' tag='cn_3dant_inline' mapDEFToID='true' url='"+b+"/"+c+"/model.x3d'></Inline></transform>";$("group#cn_3dant_shared").append(b);set_pickid("s"+tsfNum);set_form();
$("shape#point_sphere").attr("render","false");tsfNum+=1;$("#addModelModal").modal("hide")}
function insert_shape(b){function c(){var b=Math.random();return Math.round(1E3*b)/1E3}var d="true",e="";"plane"===b&&(d="false");"torus"===b&&(e="innerradius='0.5' outerradius='1'");var f=c()+","+c()+","+c(),d="<transform id='s"+tsfNum+"' tag='basic' description='\u672a\u547d\u540d' onMouseDown='selectmodel(this)' rotation='0,0,1,0' scale='1,1,1' translation='0,0,0'><shape><appearance><material diffuseColor='"+f+"'> </material></appearance><"+b+" id='g"+tsfNum+"' "+e+" solid='"+d+"'></"+b+"></shape></transform>";
$("group#cn_3dant_basic").append(d);if("text"===b){d=prompt("\u8bf7\u8f93\u5165\u6587\u5b57\u5185\u5bb9\uff1a\uff0850\u5b57\u4ee5\u5185\uff09","");if(50<d.length)return alert("\u8f93\u5165\u6587\u5b57\u5185\u5bb9\u8fc7\u957f\uff01"),!1;if(0===d.length)return alert("\u8bf7\u8f93\u5165\u6587\u5b57\u5185\u5bb9\uff01"),!1;$("text#g"+tsfNum).attr("string",d);$("text#g"+tsfNum).attr("solid","false")}set_pickid("s"+tsfNum);set_form();$("shape#point_sphere").attr("render","false");tsfNum+=1;"torus"===b&&
$(tsf_selector).find("torus").attr({innerradius:"0.5",outerradius:"1"});$("#addModelModal").modal("hide")}
function change_background(b){var c=/_\d_/,d=$("background").attr("topurl"),e=$("background").attr("lefturl"),f=$("background").attr("righturl"),g=$("background").attr("fronturl"),h=$("background").attr("bottomurl"),k=$("background").attr("backurl");b="_"+b.value+"_";d=d.replace(c,b);h=h.replace(c,b);g=g.replace(c,b);k=k.replace(c,b);f=f.replace(c,b);e=e.replace(c,b);$("background").attr("backurl",k);$("background").attr("fronturl",g);$("background").attr("topurl",d);$("background").attr("bottomurl",
h);$("background").attr("righturl",f);$("background").attr("lefturl",e)}function screenShot(b){return document.getElementById(b).runtime.getScreenshot()}function showObject(){var b;b=$(tsf_selector).find("shape").length?$(tsf_selector).find("shape")[0]:$(tsf_selector).find("inline")[0];document.getElementById("model").runtime.showObject(b)}
jQuery.extend(jQuery.validator.messages,{required:"\u5fc5\u9009\u5b57\u6bb5",remote:"\u8bf7\u4fee\u6b63\u8be5\u5b57\u6bb5",email:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684\u7535\u5b50\u90ae\u4ef6",url:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u7f51\u5740",date:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u65e5\u671f",dateISO:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u65e5\u671f (ISO).",number:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u6570\u5b57",digits:"\u53ea\u80fd\u8f93\u5165\u6574\u6570",creditcard:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u4fe1\u7528\u5361\u53f7",
equalTo:"\u8bf7\u518d\u6b21\u8f93\u5165\u76f8\u540c\u7684\u503c",accept:"\u8bf7\u8f93\u5165\u62e5\u6709\u5408\u6cd5\u540e\u7f00\u540d\u7684\u5b57\u7b26\u4e32",maxlength:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a \u957f\u5ea6\u6700\u591a\u662f {0} \u7684\u5b57\u7b26\u4e32"),minlength:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a \u957f\u5ea6\u6700\u5c11\u662f {0} \u7684\u5b57\u7b26\u4e32"),rangelength:jQuery.validator.format("\u8bf7\u8f93\u5165 \u4e00\u4e2a\u957f\u5ea6\u4ecb\u4e8e {0} \u548c {1} \u4e4b\u95f4\u7684\u5b57\u7b26\u4e32"),
range:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a\u4ecb\u4e8e {0} \u548c {1} \u4e4b\u95f4\u7684\u503c"),max:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a\u6700\u5927\u4e3a{0} \u7684\u503c"),min:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a\u6700\u5c0f\u4e3a{0} \u7684\u503c")});