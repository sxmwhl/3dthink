<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="X-UA-Compatible" content="chrome=1" /> 
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />       
    <title>手机浏览示范页面</title>
    <script type="text/javascript" src="../../js/x3dom.js"></script>
    <link rel='stylesheet' type='text/css' href='../../css/x3dom.css' />
    <script type="text/javascript" src="../../js/jquery-2.1.3.min.js"></script>
<style>
body {
	margin:0;
	padding:0;
}
#overlayHeader {
	position:absolute;
	z-index:5;
	top:50px;
	left:50px;
	padding:5px;
	color:#FFF;
	background-color:#000;
	opacity:0.5;
}
</style>
</head>
<body>
<div id="overlayHeader">
<h1>手机浏览示范页面</h1>
</div>
<x3d id='x3dElement' showStat='false' showLog='false' style='position: absolute; width:100%; height:100%; border:0; margin:0; padding:0;' disableTouch="true">
	<scene id="mainScene" dopickpass="true" pickmode="idBuf"
		bboxsize="-1,-1,-1" bboxcenter="0,0,0" render="true" def="scene">
	<viewpoint id="v" orientation="-0.064 0.997 0.052 2.19" position="40.828 1.593 -6.561" fieldofview="0.785398" centerofrotation="0,0,0" znear="-1" zfar="-1" set_bind="true"></viewpoint>	<navigationInfo id="head" headlight='true' type='"EXAMINE" "ANY"'></navigationInfo> 
	<directionalLight id="directional" direction='0,0,-1' on='true' intensity='1' shadowIntensity='0.0' color='0,0,0'></directionalLight> 
	<background
		topurl="/Public/images/background/horizon_0_top.jpg"
		righturl="/Public/images/background/horizon_0_right.jpg"
		lefturl="/Public/images/background/horizon_0_left.jpg"
		fronturl="/Public/images/background/horizon_0_front.jpg"
		bottomurl="/Public/images/background/horizon_0_bottom.jpg"
		backurl="/Public/images/background/horizon_0_back.jpg"
		skyangle="1.57" groundangle="1.57" groundcolor="1,0,0" transparency="1.0"
		skycolor="0,0,0"> </background> 
		<Environment id="gamma"	gammaCorrectionDefault="linear"></Environment>		
		<Transform id="marker" scale="0.2,0.2,0.2" translation="0,0,0">
            <Shape id="point_sphere" render="false">
                <Appearance>
                    <Material diffuseColor="#FFD966" transparency="0.15"></Material>
                </Appearance>
                <Sphere></Sphere>
            </Shape>
        </Transform>	
	<group id="cn_3dant_diy" onclick="groupClick(event)">
	<group id="cn_3dant_shared">
	<transform id="s1" tag="shared" description="未命名" onmousedown="selectmodel(this)" rotation="0,0,1,0" scale="0.1,0.1,0.1" translation="40.573,0.1,-8.647" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" scaleorientation="0,0,0,0"><inline namespacename="in" tag="cn_3dant_inline" mapdeftoid="true" url="/Public/upload/4756aaa49d937d9117e350ec34639b03/model.x3d" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" load="true"></inline></transform><transform id="s9" onmousedown="selectmodel(this)" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" translation="42.121,2.8,-6.503" rotation="-0.876,-0.344,-0.337,1.791" scale="0.1,0.1,0.1" scaleorientation="0,0,0,0" tag="shared" description="未命名_副本" position="0,0,0"><inline namespacename="in" tag="cn_3dant_inline" mapdeftoid="true" url="/Public/upload/4756aaa49d937d9117e350ec34639b03/model.x3d" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" load="true"></inline></transform><transform id="s6" onmousedown="selectmodel(this)" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" translation="37.3,-0.02,-3.417" rotation="0,0,1,0" scale="0.1,0.1,0.1" scaleorientation="0,0,0,0" tag="shared" description="未命名_副本"><inline namespacename="in" tag="cn_3dant_inline" mapdeftoid="true" url="/Public/upload/4756aaa49d937d9117e350ec34639b03/model.x3d" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" load="true"></inline></transform><transform id="s7" onmousedown="selectmodel(this)" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" translation="33,2.7,-7.7" rotation="0,0,1,0" scale="0.1,0.1,0.1" scaleorientation="0,0,0,0" tag="shared" description="未命名_副本_副本"><inline namespacename="in" tag="cn_3dant_inline" mapdeftoid="true" url="/Public/upload/4756aaa49d937d9117e350ec34639b03/model.x3d" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" load="true"></inline></transform><transform id="s5" onmousedown="selectmodel(this)" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" translation="33.1,0.2,-13.7" rotation="0,0,1,0" scale="0.1,0.1,0.1" scaleorientation="0,0,0,0" tag="shared" description="未命名_副本"><inline namespacename="in" tag="cn_3dant_inline" mapdeftoid="true" url="/Public/upload/4756aaa49d937d9117e350ec34639b03/model.x3d" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" load="true"></inline></transform><transform id="s4" onmousedown="selectmodel(this)" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" translation="51,1.693,-13" rotation="0,0,1,0" scale="0.1,0.1,0.1" scaleorientation="0,0,0,0" tag="shared" description="未命名_副本"><inline namespacename="in" tag="cn_3dant_inline" mapdeftoid="true" url="/Public/upload/4756aaa49d937d9117e350ec34639b03/model.x3d" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" load="true"></inline></transform><transform id="s3" onmousedown="selectmodel(this)" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" translation="41.055,0.65,-10.87" rotation="0,0,1,0" scale="0.1,0.1,0.1" scaleorientation="0,0,0,0" tag="shared" description="未命名_副本"><inline namespacename="in" tag="cn_3dant_inline" mapdeftoid="true" url="/Public/upload/4756aaa49d937d9117e350ec34639b03/model.x3d" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" load="true"></inline></transform><transform id="s8" onmousedown="selectmodel(this)" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" translation="38.351,2.7,-7.361" rotation="0.945,0.316,0.08,4.046" scale="0.1,0.1,0.1" scaleorientation="0,0,0,0" tag="shared" description="未命名_副本_副本" position="0,0,0"><inline namespacename="in" tag="cn_3dant_inline" mapdeftoid="true" url="/Public/upload/4756aaa49d937d9117e350ec34639b03/model.x3d" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" load="true"></inline></transform><transform id="s2" tag="shared" description="未命名" onmousedown="selectmodel(this)" rotation="0,0,0,0" scale="1,1,1" translation="0,0,0" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" scaleorientation="0,0,0,0" position="0,0,0"><inline namespacename="in" tag="cn_3dant_inline" mapdeftoid="true" url="/Public/upload/b9562b9dba7a63533409684bb296ebcc/model.x3d" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" load="true"></inline></transform>	</group>
	<group id="cn_3dant_basic">
		</group>
	<group id="cn_3dant_internet"></group>	
	</group>	
	</scene>
	</x3d>
<script>
    var runtime = null;
    var degreeToRadiansFactor = Math.PI / 180;

    x3dom.fields.Quaternion.prototype.setFromEulerYXZ = function (alpha, beta, gamma) {

        var c1 = Math.cos( alpha / 2 );
        var c2 = Math.cos( beta / 2 );
        var c3 = Math.cos( gamma / 2 );
        var s1 = Math.sin( alpha / 2 );
        var s2 = Math.sin( beta / 2 );
        var s3 = Math.sin( gamma / 2 );

        this.x = s1 * c2 * c3 + c1 * s2 * s3;
        this.y = c1 * s2 * c3 - s1 * c2 * s3;
        this.z = c1 * c2 * s3 - s1 * s2 * c3;
        this.w = c1 * c2 * c3 + s1 * s2 * s3;
    }

    var MYAPP={"deviceOrientation":null, "screenOrientation":null};
    onDeviceOrientationChangeEvent = (function(rawEvtData) {
        this.deviceOrientation = rawEvtData;
    }).bind(MYAPP);

    window.addEventListener('deviceorientation', onDeviceOrientationChangeEvent, false);

    function deg2rad(deg){return deg * degreeToRadiansFactor;}

    document.onload = function ()
    {
        runtime = document.getElementById('x3dElement').runtime;
        var element = document.getElementById("x3dElement");
        MYAPP.viewpoint = document.getElementById('v');
        element.runtime.exitFrame = function() {
            //handle device orientation change
            if(!MYAPP.deviceOrientation)
                return;
            var q0 = x3dom.fields.Quaternion.axisAngle(new x3dom.fields.SFVec3f(0,0,1),-deg2rad(window.orientation)); // phone rotation offset
            var q = new x3dom.fields.Quaternion();
            q.setFromEulerYXZ(deg2rad(MYAPP.deviceOrientation.beta), deg2rad(MYAPP.deviceOrientation.alpha), -deg2rad(MYAPP.deviceOrientation.gamma));

            var q1 = new x3dom.fields.Quaternion.axisAngle(new x3dom.fields.SFVec3f(1,0,0),-Math.PI/2); // device orientation points upwards. rotate down to camera orientation

            q = q.multiply(q1);
            q = q.multiply(q0);

            var aa = q.toAxisAngle();

            MYAPP.viewpoint.setAttribute("orientation", aa[0].x + " " + aa[0].y + " " + aa[0].z + " " + aa[1]);
        };
    }

</script>
</body>
</html>